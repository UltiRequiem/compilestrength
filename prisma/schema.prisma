generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Better Auth Core Schema
model user {
  id               String            @id
  name             String
  email            String            @unique
  emailVerified    Boolean
  image            String?
  createdAt        DateTime
  updatedAt        DateTime
  sessions         session[]
  accounts         account[]
  programs         WorkoutProgram[]
  workoutSessions  WorkoutSession[]
  personalRecords  PersonalRecord[]
  preferences      UserPreferences?
}

model session {
  id        String   @id
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime
  updatedAt DateTime
  ipAddress String?
  userAgent String?
  userId    String
  user      user     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model account {
  id           String    @id
  accountId    String
  providerId   String
  userId       String
  accessToken  String?
  refreshToken String?
  idToken      String?
  expiresAt    DateTime?
  password     String?
  createdAt    DateTime
  updatedAt    DateTime
  user         user      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?
}

// Workout Application Schema
model WorkoutProgram {
  id              String       @id @default(cuid())
  userId          String
  name            String
  description     String?
  goalType        String       // strength, hypertrophy, endurance, general
  experienceLevel String       // beginner, intermediate, advanced
  frequency       Int          // workouts per week
  durationWeeks   Int
  isActive        Boolean      @default(true)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  user            user         @relation(fields: [userId], references: [id], onDelete: Cascade)
  workoutDays     WorkoutDay[]

  @@index([userId])
}

model WorkoutDay {
  id               String            @id @default(cuid())
  programId        String
  dayNumber        Int               // 1-7 for day of week
  name             String            // "Push Day A", "Pull Day B"
  type             String            // push, pull, legs, upper, lower, full, rest
  description      String?
  program          WorkoutProgram    @relation(fields: [programId], references: [id], onDelete: Cascade)
  exercises        ProgramExercise[]
  workoutSessions  WorkoutSession[]

  @@index([programId])
}

model Exercise {
  id               String            @id @default(cuid())
  name             String            @unique
  description      String?
  muscleGroup      String            // chest, back, legs, shoulders, arms, core
  equipmentType    String            // barbell, dumbbell, machine, bodyweight, cable
  difficulty       String            // beginner, intermediate, advanced
  videoUrl         String?
  createdAt        DateTime          @default(now())
  programExercises ProgramExercise[]
  workoutSets      WorkoutSet[]
  personalRecords  PersonalRecord[]
}

model ProgramExercise {
  id           String     @id @default(cuid())
  workoutDayId String
  exerciseId   String
  sets         Int
  reps         String     // "8-12" or "10" for ranges
  restSeconds  Int        @default(90)
  notes        String?
  order        Int        // order in workout
  workoutDay   WorkoutDay @relation(fields: [workoutDayId], references: [id], onDelete: Cascade)
  exercise     Exercise   @relation(fields: [exerciseId], references: [id])

  @@index([workoutDayId])
  @@index([exerciseId])
}

model WorkoutSession {
  id           String       @id @default(cuid())
  userId       String
  workoutDayId String?
  startTime    DateTime     @default(now())
  endTime      DateTime?
  notes        String?
  completedAt  DateTime?
  user         user         @relation(fields: [userId], references: [id], onDelete: Cascade)
  workoutDay   WorkoutDay?  @relation(fields: [workoutDayId], references: [id])
  sets         WorkoutSet[]

  @@index([userId])
  @@index([workoutDayId])
}

model WorkoutSet {
  id         String         @id @default(cuid())
  sessionId  String
  exerciseId String
  setNumber  Int
  reps       Int
  weight     Float
  rpe        Int?           // Rate of Perceived Exertion 1-10
  completedAt DateTime      @default(now())
  session    WorkoutSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  exercise   Exercise       @relation(fields: [exerciseId], references: [id])

  @@index([sessionId])
  @@index([exerciseId])
}

model PersonalRecord {
  id         String   @id @default(cuid())
  userId     String
  exerciseId String
  weight     Float
  reps       Int
  recordType String   // 1rm, 3rm, 5rm, volume
  achievedAt DateTime @default(now())
  user       user     @relation(fields: [userId], references: [id], onDelete: Cascade)
  exercise   Exercise @relation(fields: [exerciseId], references: [id])

  @@index([userId])
  @@index([exerciseId])
}

model UserPreferences {
  userId            String  @id
  units             String  @default("lbs") // lbs or kg
  restTimerDefault  Int     @default(90)     // seconds
  trainingGoal      String? // strength, hypertrophy, endurance
  experienceLevel   String? // beginner, intermediate, advanced
  availableDays     Int?    // days per week
  user              user    @relation(fields: [userId], references: [id], onDelete: Cascade)
}
